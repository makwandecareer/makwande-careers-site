@echo off
setlocal EnableExtensions EnableDelayedExpansion

echo Cleaning inline nav artifacts from all .html files...
for /r %%F in (*.html) do (
  set "skip=0"
  >"%%F.tmp" (
    for /f "usebackq delims=" %%L in ("%%F") do (
      set "line=%%L"

      rem Start skipping at any of these markers:
      echo(!line!| findstr /i /c:"/* ---------- Dynamic Nav: wire every page" /c:"function injectNav" >nul && set "skip=1"
      echo(!line!| findstr /i /c:"dropdown =" >nul && set "skip=1"

      if !skip! EQU 1 (
        rem End skip when we hit the closing backtick+semicolon
        echo(!line!| findstr /c:"`;" >nul && set "skip=0"
        rem (do not output skipped lines)
      ) else (
        rem Drop leftover single-line artifacts:
        echo(!line!| findstr /i /c:"container.innerHTML =" /c:"document.addEventListener('DOMContentLoaded" >nul || echo(!line!
      )
    )
  )
  move /y "%%F.tmp" "%%F" >nul
  echo Cleaned: %%F
)
echo Done.
