<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Apply for Bursary — Makwande Careers</title>
  <meta name="description" content="Submit a bursary application online in minutes." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/app.css">
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="brand"><a href="/index.html">Makwande Careers</a></div>
    <div>
      <a href="/learners.html">Learners</a>
      <a href="/bursaries.html">Bursaries</a>
      <a href="/login.html">Log in</a>
      <a class="btn" href="/signup.html">Create account</a>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero" style="padding-bottom:3rem;">
    <h1 id="bursaryTitle">Bursary Application</h1>
    <p id="bursarySub">Loading bursary details…</p>
    <a class="btn btn-secondary" href="/bursaries.html">← Back to bursaries</a>
  </header>

  <section class="section" style="padding-top:2rem;">
    <div style="display:grid;grid-template-columns:2fr 1fr;gap:1rem;align-items:start;">
      <!-- FORM CARD -->
      <div class="card">
        <h2 style="margin-bottom:.6rem;">Your details</h2>
        <form id="applyForm">
          <input type="hidden" id="bursary_id" name="bursary_id">

          <label>Full name</label>
          <input class="form-control" name="full_name" placeholder="e.g., Ayanda Nkosi" required>

          <label>Email</label>
          <input class="form-control" type="email" name="email" placeholder="you@example.com" required>

          <label>Phone</label>
          <input class="form-control" name="phone" placeholder="+27 82 000 0000" required>

          <label>ID/Passport number</label>
          <input class="form-control" name="national_id" placeholder="e.g., 9901015800087" required>

          <label>Country</label>
          <input class="form-control" name="country" placeholder="e.g., South Africa" required>

          <label>Institution (current or intended)</label>
          <input class="form-control" name="institution" placeholder="e.g., UCT" required>

          <label>Field of study</label>
          <input class="form-control" name="field_of_study" placeholder="e.g., Engineering" required>

          <label>Motivation statement</label>
          <textarea class="form-control" name="motivation" rows="6" placeholder="Explain why you qualify and your goals…" required></textarea>

          <label>Document link (CV/Transcript/ID)</label>
          <input class="form-control" name="document_url" placeholder="Paste a public link (Drive/Dropbox)" required>

          <div style="display:flex;gap:.6rem;align-items:center;margin-top:1rem;">
            <button type="submit" class="btn">Submit application</button>
            <span id="applyStatus" class="badge badge-info" style="display:none;">Submitting…</span>
          </div>
          <p id="applyMsg" style="margin-top:.6rem;color:#155724;display:none;"></p>
          <p id="applyErr" style="margin-top:.6rem;color:#b00020;display:none;"></p>
        </form>
      </div>

      <!-- SUMMARY CARD -->
      <aside class="card">
        <h2 style="margin-bottom:.6rem;">About this bursary</h2>
        <p id="bursaryDesc" style="margin-bottom:.6rem;">Loading…</p>
        <div style="display:flex;flex-wrap:wrap;gap:.4rem;">
          <span class="badge badge-info" id="badgeCountry"></span>
          <span class="badge badge-success" id="badgeField"></span>
          <span class="badge badge-warning" id="badgeAmount"></span>
          <span class="badge badge-danger" id="badgeDeadline"></span>
        </div>
      </aside>
    </div>
  </section>

  <!-- CTA -->
  <section class="cta">
    <h2>Track your application</h2>
    <p>Create a free account to view status updates and messages.</p>
    <a class="btn btn-accent" href="/signup.html">Create account</a>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div style="margin-bottom:.6rem;">
      <a href="/learners.html">Learners</a> •
      <a href="/bursaries.html">Bursaries</a> •
      <a href="/partnerships.html">Partnerships</a> •
      <a href="/brand-collaborations.html">Brand Collabs</a> •
      <a href="/investors.html">Investors</a>
    </div>
    <div>© <span id="year"></span> Makwande Careers. All rights reserved.</div>
  </footer>

  <script>
    // ===== Utils =====
    const API_DEFAULT = 'http://127.0.0.1:8000';
    const getApiBase = () => localStorage.getItem('apiBase') || API_DEFAULT;
    const qs = (k) => new URL(location.href).searchParams.get(k);
    const $ = (id) => document.getElementById(id);
    $('year').textContent = new Date().getFullYear();

    async function fetchJson(path, options = {}) {
      const res = await fetch(getApiBase() + path, { headers: { 'Content-Type':'application/json' }, ...options });
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    }
    function money(v){ try { return 'R' + Number(v).toLocaleString(); } catch { return 'R' + v; } }

    // ===== Load bursary details =====
    async function loadBursary() {
      const id = qs('id');
      if (!id) return;
      $('bursary_id').value = id;
      try {
        const b = await fetchJson(`/api/public/bursaries/${id}`);
        $('bursaryTitle').textContent = b.title;
        $('bursarySub').textContent = `${b.provider} • ${b.country}`;
        $('bursaryDesc').textContent = b.description;
        $('badgeCountry').textContent = b.country;
        $('badgeField').textContent = b.field_of_study;
        $('badgeAmount').textContent = money(b.amount);
        $('badgeDeadline').textContent = 'Deadline: ' + b.deadline;
      } catch (e) {
        $('bursarySub').textContent = 'Could not load bursary. It may have been removed.';
      }
    }

    // ===== Submit application =====
    function bindSubmit() {
      const form = $('applyForm');
      const status = $('applyStatus');
      const ok = $('applyMsg');
      const err = $('applyErr');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        status.style.display = 'inline-block';
        ok.style.display = 'none';
        err.style.display = 'none';

        const data = Object.fromEntries(new FormData(form).entries());
        try {
          await fetchJson('/api/bursaries/apply', { method:'POST', body: JSON.stringify(data) });
          ok.textContent = 'Application submitted! Check your email for confirmation.';
          ok.style.display = 'block';
          form.reset();
        } catch (e) {
          err.textContent = 'Submission failed: ' + e.message;
          err.style.display = 'block';
        } finally {
          status.style.display = 'none';
        }
      });
    }

    // Init
    loadBursary();
    bindSubmit();
  </script>
</body>
</html>
