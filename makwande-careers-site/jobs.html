<!DOCTYPE html>
<html lang="en">
  <link rel="stylesheet" href="assets/css/app.css">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jobs – Makwande Careers</title>
  <link rel="stylesheet" href="assets/css/app.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- ====== Navbar ====== -->
<nav class="navbar navbar-expand-lg sticky-top shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">Makwande Careers</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" href="jobs.html">Jobs</a></li>
        <li class="nav-item"><a class="nav-link" href="bursaries.html">Bursaries</a></li>
        <li class="nav-item"><a class="nav-link" href="candidates.html">Candidates</a></li>
        <li class="nav-item"><a class="nav-link" href="recruiters.html">Recruiters</a></li>
        <li class="nav-item"><a class="nav-link" href="employers.html">Employers</a></li>
        <li class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- ====== Header ====== -->
<header class="py-5 text-center bg-light shadow-sm">
  <div class="container">
    <h1 class="fw-bold">Available Jobs</h1>
    <p class="lead text-muted">Explore tailored opportunities across Africa.</p>
  </div>
</header>

<!-- ====== Filters ====== -->
<section class="py-4">
  <div class="container">
    <form class="row g-3 align-items-center">
      <div class="col-md-4">
        <input type="text" class="form-control" placeholder="Search job title or keywords">
      </div>
      <div class="col-md-3">
        <select class="form-select">
          <option selected>All Locations</option>
          <option value="South Africa">South Africa</option>
          <option value="Nigeria">Nigeria</option>
          <option value="Kenya">Kenya</option>
          <option value="Mozambique">Mozambique</option>
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select">
          <option selected>All Companies</option>
          <option>Standard Bank</option>
          <option>MTN</option>
          <option>Shoprite</option>
          <option>Flutterwave</option>
        </select>
      </div>
      <div class="col-md-2 d-grid">
        <button type="submit" class="btn btn-primary">Filter</button>
      </div>
    </form>
  </div>
</section>

<!-- ====== Jobs Table ====== -->
<section class="pb-5">
  <div class="container">
    <div class="table-responsive shadow-sm">
      <table class="table table-striped align-middle">
        <thead class="table-dark">
          <tr>
            <th>Title</th>
            <th>Company</th>
            <th>Location</th>
            <th>Match</th>
            <th>Posted</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="jobs-table-body">
          <!-- Example static row -->
          <tr>
            <td>Software Engineer</td>
            <td>MTN</td>
            <td>South Africa</td>
            <td><span class="badge bg-success">92%</span></td>
            <td>3 days ago</td>
            <td><a href="#" class="btn btn-sm btn-outline-primary">Apply</a></td>
          </tr>
          <!-- More rows injected dynamically by backend -->
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- ====== Footer ====== -->
<footer class="py-4 bg-light mt-auto">
  <div class="container text-center">
    <p class="mb-1">© 2025 Makwande Careers. All Rights Reserved.</p>
    <small>
      <a href="marketing.html">Marketing</a> · 
      <a href="brand-collaborations.html">Brand Collaborations</a> · 
      <a href="contact.html">Contact Us</a>
    </small>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Placeholder: Replace with backend fetch
document.addEventListener("DOMContentLoaded", () => {
  console.log("Jobs page ready. Hook to API here.");
});
</script>
<footer class="bg-dark text-light text-center py-4 mt-5">
  <div class="container">
    <p class="mb-1">&copy; <span id="year"></span> Makwande Careers. All rights reserved.</p>
    <p class="small">
      Empowering Africa’s professionals with smarter job applications, bursaries, and career growth.
    </p>
  </div>
</footer>

<script>
  // auto-update year
  document.getElementById("year").textContent = new Date().getFullYear();
</script>
<script>
  // ====== BASIC API CLIENT (paste once per page that needs API) ======
  window.API_BASE = "https://autoapplyapp-mobile.onrender.com";  // FastAPI base
  const TOKEN_KEY = "mc_token";
  
  // Auth helpers
  function setToken(t){ localStorage.setItem(TOKEN_KEY, t); }
  function getToken(){ return localStorage.getItem(TOKEN_KEY); }
  function authHeaders(h={}) {
    const t = getToken();
    return t ? {...h, Authorization: `Bearer ${t}`} : h;
  }
  
  // API helper (GET/POST/etc)
  async function api(path, {method="GET", body, headers} = {}) {
    const res = await fetch(`${API_BASE}${path}`, {
      method,
      headers: authHeaders({
        "Content-Type": "application/json",
        ...(headers||{})
      }),
      body: body ? JSON.stringify(body) : undefined
    });
    if (!res.ok) throw new Error(await res.text());
    return res.status === 204 ? null : res.json();
  }
  </script>
  <script>
    const API_BASE = window.API_BASE_URL || "https://YOUR-RENDER-API.onrender.com"; // set a global if you prefer
    const state = {
      q: "", location: "Gauteng", company: "", source: "",
      days: 7, limit: 25, offset: 0, busy: false
    };
    
    const els = {
      list: document.getElementById("jobs-list"),
      loadMore: document.getElementById("jobs-load-more"),
      q: document.getElementById("filter-q"),
      loc: document.getElementById("filter-location"),
      src: document.getElementById("filter-source"),
      company: document.getElementById("filter-company"),
      count: document.getElementById("jobs-count"),
      updated: document.getElementById("jobs-updated")
    };
    
    function fmtDate(s){ return s || ""; }
    
    function jobCard(j){
      return `
      <div class="card mb-3 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <h5 class="card-title mb-1">${j.title}</h5>
            <span class="badge text-bg-light">${j.source?.toUpperCase() || ""}</span>
          </div>
          <h6 class="card-subtitle text-muted mb-2">${j.company || ""}</h6>
          <p class="card-text">
            <small class="text-muted">${j.location || ""} • Posted ${fmtDate(j.posted_date)}</small>
          </p>
          <a class="btn btn-primary btn-sm" href="${j.url}" target="_blank" rel="noopener">View & Apply</a>
        </div>
      </div>`;
    }
    
    async function fetchJobs(append=false){
      if (state.busy) return;
      state.busy = true;
      els.loadMore?.setAttribute("disabled","disabled");
      try {
        const params = new URLSearchParams({
          q: state.q, location: state.location, company: state.company,
          source: state.source, days: String(state.days),
          limit: String(state.limit), offset: String(state.offset), order: "recent"
        });
        const r = await fetch(`${API_BASE}/api/jobs?` + params.toString(), { mode: "cors" });
        if (!r.ok) throw new Error("API error");
        const data = await r.json();
    
        if (!append) els.list.innerHTML = "";
        data.forEach(j => els.list.insertAdjacentHTML("beforeend", jobCard(j)));
        els.count.textContent = (parseInt(els.count.textContent||"0") + data.length).toString();
        els.updated.textContent = new Date().toLocaleString();
    
        // enable/disable Load More
        if (data.length < state.limit) {
          els.loadMore?.setAttribute("disabled","disabled");
        } else {
          els.loadMore?.removeAttribute("disabled");
        }
      } catch (e) {
        console.error(e);
        alert("Could not fetch jobs. Please try again later.");
      } finally {
        state.busy = false;
      }
    }
    
    function resetAndFetch(){
      state.offset = 0;
      els.count.textContent = "0";
      fetchJobs(false);
    }
    
    function bindUI(){
      els.q?.addEventListener("input", e => { state.q = e.target.value.trim(); resetAndFetch(); });
      els.loc?.addEventListener("change", e => { state.location = e.target.value; resetAndFetch(); });
      els.src?.addEventListener("change", e => { state.source = e.target.value; resetAndFetch(); });
      els.company?.addEventListener("input", e => { state.company = e.target.value.trim(); resetAndFetch(); });
      els.loadMore?.addEventListener("click", () => { state.offset += state.limit; fetchJobs(true); });
    }
    
    // bootstrap
    document.addEventListener("DOMContentLoaded", () => {
      bindUI();
      resetAndFetch();
    });
    </script>
    
</body>
<table class="table table-striped">
  <thead><tr>
    <th>Title</th><th>Company</th><th>Location</th><th>Match</th><th>Posted</th><th></th>
  </tr></thead>
  <tbody id="jobsBody"></tbody>
</table>
<script>
  async function loadJobs(){
    try {
      const rows = await api("/api/jobs");  // expects list: [{id,title,company,location,match,posted_at}, ...]
      const body = document.getElementById("jobsBody");
      body.innerHTML = rows.map(j => `
        <tr>
          <td>${j.title}</td>
          <td>${j.company}</td>
          <td>${j.location || "—"}</td>
          <td><span class="badge-soft">${(j.match ?? 0)}%</span></td>
          <td>${j.posted_at ? new Date(j.posted_at).toLocaleDateString() : "—"}</td>
          <td><a class="btn btn-sm btn-primary" href="autoapply.html?job=${encodeURIComponent(j.id)}">Apply</a></td>
        </tr>
      `).join("") || `<tr><td colspan="6" class="text-center text-muted">No jobs yet.</td></tr>`;
    } catch(e) {
      console.error(e); alert("Couldn’t load jobs");
    }
  }
  loadJobs();
  </script>
  <!-- Minimal filters + list -->
<div class="row g-2 mb-3">
  <div class="col-12 col-md"><input id="filter-q" class="form-control" placeholder="Search title or company"></div>
  <div class="col-6 col-md"><input id="filter-company" class="form-control" placeholder="Company"></div>
  <div class="col-6 col-md">
    <select id="filter-location" class="form-select">
      <option value="Gauteng" selected>Gauteng</option>
      <option value="Western Cape">Western Cape</option>
      <option value="KwaZulu-Natal">KwaZulu-Natal</option>
    </select>
  </div>
  <div class="col-6 col-md">
    <select id="filter-source" class="form-select">
      <option value="">All sources</option>
      <option value="indeed">Indeed</option>
      <option value="pnet">PNet</option>
      <option value="career24">Career24</option>
    </select>
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-2">
  <div><strong id="jobs-count">0</strong> jobs loaded</div>
  <div class="text-muted small">Updated: <span id="jobs-updated">—</span></div>
</div>

<div id="jobs-list"></div>

<div class="d-grid mt-3">
  <button id="jobs-load-more" class="btn btn-outline-primary">Load more</button>
</div>

<script>
// Load API base from site-config.json
letAPI_BASE = "";
fetch("./site-config.json").then(r => r.json()).then(cfg => {
  API_BASE = cfg.API_BASE_URL;
  init();
}).catch(() => {
  // fallback if config missing — set your API URL here:
  API_BASE = "https://YOUR-API-SERVICE.onrender.com";
  init();
});

function init(){
  const state = { q:"", location:"Gauteng", company:"", source:"", days:7, limit:25, offset:0, busy:false };
  const els = {
    list: document.getElementById("jobs-list"),
    loadMore: document.getElementById("jobs-load-more"),
    q: document.getElementById("filter-q"),
    loc: document.getElementById("filter-location"),
    src: document.getElementById("filter-source"),
    company: document.getElementById("filter-company"),
    count: document.getElementById("jobs-count"),
    updated: document.getElementById("jobs-updated")
  };

  function jobCard(j){
    return `
    <div class="card mb-3 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <h5 class="card-title mb-1">${j.title}</h5>
          <span class="badge text-bg-light">${(j.source||"").toUpperCase()}</span>
        </div>
        <h6 class="card-subtitle text-muted mb-2">${j.company||""}</h6>
        <p class="card-text"><small class="text-muted">${j.location||""} • Posted ${j.posted_date||""}</small></p>
        <a class="btn btn-primary btn-sm" href="${j.url}" target="_blank" rel="noopener">View & Apply</a>
      </div>
    </div>`;
  }

  async function fetchJobs(append=false){
    if (state.busy) return;
    state.busy = true; els.loadMore?.setAttribute("disabled","disabled");
    try {
      const params = new URLSearchParams({
        q: state.q, location: state.location, company: state.company, source: state.source,
        days: String(state.days), limit: String(state.limit), offset: String(state.offset), order: "recent"
      });
      const r = await fetch(`${API_BASE}/api/jobs?`+params.toString(), { mode:"cors" });
      if (!r.ok) throw new Error("API error");
      const data = await r.json();

      if (!append) els.list.innerHTML = "";
      data.forEach(j => els.list.insertAdjacentHTML("beforeend", jobCard(j)));
      els.count.textContent = (parseInt(els.count.textContent||"0")+data.length).toString();
      els.updated.textContent = new Date().toLocaleString();

      if (data.length < state.limit) els.loadMore?.setAttribute("disabled","disabled");
      else els.loadMore?.removeAttribute("disabled");
    } catch (e) {
      console.error(e); alert("Could not fetch jobs. Please try again later.");
    } finally {
      state.busy = false;
    }
  }

  function resetAndFetch(){ state.offset = 0; els.count.textContent = "0"; fetchJobs(false); }

  els.q?.addEventListener("input", e => { state.q = e.target.value.trim(); resetAndFetch(); });
  els.loc?.addEventListener("change", e => { state.location = e.target.value; resetAndFetch(); });
  els.src?.addEventListener("change", e => { state.source = e.target.value; resetAndFetch(); });
  els.company?.addEventListener("input", e => { state.company = e.target.value.trim(); resetAndFetch(); });
  els.loadMore?.addEventListener("click", () => { state.offset += state.limit; fetchJobs(true); });

  resetAndFetch();
}
</script>

</html>
