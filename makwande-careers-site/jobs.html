<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jobs â€” Makwande Careers</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#f3f6f8;           /* neutral background */
      --panel:#ffffff;        /* cards/panels */
      --ink:#0b1f33;          /* main text */
      --muted:#5b6b7b;        /* secondary text */
      --border:#e6edf2;       /* borders */
      --accent:#0a66c2;       /* LinkedIn blue */
      --chip:#f0f4f8;
      --ok:#1a7f37;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0e141a; --panel:#0f1821;
        --ink:#e9f1f6; --muted:#a8b4bf; --border:#1d2a36;
        --chip:#14202b; --accent:#4aa3ff;
      }
    }
    * { box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font: 15px/1.55 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    .wrap{ max-width:1140px; margin:0 auto; padding:24px 16px 72px; }
    header{
      background: var(--panel);
      border:1px solid var(--border);
      border-radius: 14px;
      padding: 18px 16px;
      box-shadow: 0 8px 24px rgba(2,12,20,.06);
      margin: 8px 0 18px;
    }
    h1{ margin:0 0 4px; font-weight:800; letter-spacing:.2px; font-size: clamp(26px, 4vw, 40px); }
    header p{ margin:0; color:var(--muted); }

    /* controls */
    .controls{
      display:grid; gap:12px; grid-template-columns: 1fr;
      margin: 16px 0 10px;
    }
    @media (min-width: 780px){
      .controls{ grid-template-columns: 220px 1fr 110px auto auto; align-items:end; }
    }
    label{ display:block; font-size:12px; color:var(--muted); margin:0 0 6px; letter-spacing:.3px; }
    select,input[type="text"]{
      width:100%; padding:10px 12px; border-radius:10px;
      background:var(--panel); color:var(--ink);
      border:1px solid var(--border); outline: none;
      box-shadow: 0 1px 0 rgba(0,0,0,.04);
    }
    .btn{
      appearance:none; border:1px solid var(--accent);
      padding:10px 14px; border-radius:10px; cursor:pointer;
      background: var(--accent); color:#fff; font-weight:700; letter-spacing:.2px;
      box-shadow: 0 6px 18px rgba(10,102,194,.25);
    }
    .btn.secondary{
      background: transparent; color:var(--accent);
      border:1px solid var(--accent); box-shadow:none;
    }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }
    .status{ min-height: 22px; color:var(--muted); margin: 8px 4px 2px; }

    /* cards */
    .grid{ display:grid; gap:14px; grid-template-columns: 1fr; margin-top:10px; }
    @media (min-width: 760px){ .grid{ grid-template-columns: repeat(2,1fr); } }
    @media (min-width: 1080px){ .grid{ grid-template-columns: repeat(3,1fr); } }
    .card{
      background: var(--panel);
      border:1px solid var(--border); border-radius:12px; padding:12px 14px 12px;
      box-shadow: 0 6px 20px rgba(2,12,20,.06);
    }
    .card h3{ margin:0 0 6px; font-size:16px; line-height:1.35; }
    .card h3 a{ color:var(--ink); text-decoration:none; }
    .card h3 a:hover{ text-decoration:underline; }
    .meta{ display:flex; flex-wrap:wrap; gap:8px; color:var(--muted); font-size:12px; }
    .chip{ background: var(--chip); border:1px solid var(--border); padding:2px 8px; border-radius:999px; }
    .ok{ color:var(--ok); font-weight:700; }
    .empty{
      padding:16px; border-radius:12px; border:1px dashed var(--border);
      color:var(--muted); background: var(--panel);
    }
    .pager{ display:flex; align-items:center; gap:10px; margin:16px 2px 0; }
    .page{ width:42px; text-align:center; color:var(--muted); }

    .toast{
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 18px; background:#0a2238; color:#fff; border:1px solid #13324d;
      padding: 10px 14px; border-radius: 10px; box-shadow: 0 10px 26px rgba(0,0,0,.25);
      max-width: 92vw; display:none; z-index:999;
    }
    .skeleton{ height:112px; border-radius:12px; background:
      linear-gradient(90deg, rgba(0,0,0,.04), rgba(0,0,0,.02), rgba(0,0,0,.04));
      animation: sh 1.2s infinite; border:1px solid var(--border);
    }
    @keyframes sh{ 0%{ background-position:-240px 0 } 100%{ background-position:240px 0 } }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Makwande Careers</h1>
      <p>Fresh roles across the SADC region â€” updated regularly.</p>
    </header>

    <section class="controls" id="controls">
      <div>
        <label for="country">Country</label>
        <select id="country"></select>
      </div>
      <div>
        <label for="q">Search</label>
        <input id="q" type="text" placeholder="e.g. analyst, finance, graduate" />
      </div>
      <div>
        <label for="limit">Limit</label>
        <select id="limit">
          <option>10</option><option selected>20</option><option>30</option><option>50</option>
        </select>
      </div>
      <button class="btn" id="load">Load Jobs</button>
      <button class="btn secondary" id="reset">Reset</button>
    </section>

    <div class="status" id="status" aria-live="polite"></div>

    <section class="pager">
      <button class="btn secondary" id="prev" disabled>Prev</button>
      <span class="page" id="pageNum">1</span>
      <button class="btn secondary" id="next" disabled>Next</button>
    </section>

    <section class="grid" id="results" aria-live="polite"></section>
  </div>

  <div class="toast" id="toast"></div>

  <script>
  (async () => {
    const $ = (id) => document.getElementById(id);
    const resultsEl = $("results"), statusEl = $("status"), toastEl = $("toast");
    const countryEl = $("country"), qEl = $("q"), limitEl = $("limit");
    const prevBtn = $("prev"), nextBtn = $("next"), pageEl = $("pageNum");
    const loadBtn = $("load"), resetBtn = $("reset");

    // 10 SADC countries
    const COUNTRIES = [
      { code:"ZA", name:"South Africa" },
      { code:"NA", name:"Namibia" },
      { code:"BW", name:"Botswana" },
      { code:"ZW", name:"Zimbabwe" },
      { code:"ZM", name:"Zambia" },
      { code:"MZ", name:"Mozambique" },
      { code:"AO", name:"Angola" },
      { code:"MW", name:"Malawi" },
      { code:"LS", name:"Lesotho" },
      { code:"SZ", name:"Eswatini" }
    ];

    // ðŸ”§ FIXED: this line uses backticks so itâ€™s a string, not raw HTML in JS.
    countryEl.innerHTML = "";
const all = document.createElement("option");
all.value = "";
all.textContent = "All locations";
countryEl.appendChild(all);

for (const c of COUNTRIES) {
  const o = document.createElement("option");
  o.value = c.code;
  o.textContent = c.name;
  countryEl.appendChild(o);
}

    function setStatus(t){ statusEl.textContent = t || ""; }
    function toast(t){ toastEl.textContent = t; toastEl.style.display="block"; clearTimeout(toast._t); toast._t=setTimeout(()=>toastEl.style.display="none", 4000); }
    function setLoading(on){
      loadBtn.disabled = on; prevBtn.disabled = on || state.page<=1; nextBtn.disabled = on;
    }
    function skeleton(n=6){
      resultsEl.innerHTML = ""; for(let i=0;i<n;i++){ const d=document.createElement("div"); d.className="skeleton"; resultsEl.appendChild(d); }
    }

    const urlParams = new URLSearchParams(location.search);
    const state = {
      page: Number(urlParams.get("page") || 1),
      limit: Number(urlParams.get("limit") || 20),
      q: (urlParams.get("q") || "").trim(),
      country: urlParams.get("country") || ""
    };
    pageEl.textContent = state.page; limitEl.value = String(state.limit); qEl.value = state.q; countryEl.value = state.country;

    // -------- API base (robust) --------
    let API_BASE = (urlParams.get("api") || "").trim();
    async function readConfig(){
      try{
        const r = await fetch("/site-config.json", { cache:"no-store" });
        if (!r.ok) return;
        const ct = (r.headers.get("content-type") || "").toLowerCase();
        if (!ct.includes("application/json")) return;   // avoid parsing HTML
        const cfg = await r.json().catch(()=> ({}));
        if (!API_BASE && cfg && typeof cfg.API_BASE === "string" && cfg.API_BASE.trim()){
          API_BASE = cfg.API_BASE.trim().replace(/\/+$/,'');
        }
      }catch(_){}
    }
    await readConfig();
    if (!API_BASE) API_BASE = "https://autoapplyapp.onrender.com";

    function buildURL(page){
      const offset = (page-1) * state.limit;
      const qs = new URLSearchParams();
      if (state.country) qs.set("country", state.country);
      if (state.q) qs.set("q", state.q);
      qs.set("limit", String(state.limit));
      if (offset>0) qs.set("offset", String(offset));
      return API_BASE.replace(/\/+$/,'') + "/jobs?" + qs.toString();
    }

    function render(items){
      resultsEl.innerHTML = "";
      if (!items || !items.length){
        resultsEl.innerHTML = <div class="empty">No results right now. Try a broader search or a different country.</div>;
        return;
      }
      const frag = document.createDocumentFragment();
      for (const job of items){
        const a = document.createElement("article");
        a.className = "card";
        const title = job.title || "Untitled role";
        const company = job.company || "â€”";
        const loc = job.location || job.country_name || job.country || "â€”";
        const src = job.source || "web";
        const match = (typeof job.match === "number") ? Math.round(job.match) : null;
        const url = job.url || "#";
        const posted = job.posted_at ? new Date(job.posted_at) : null;

        a.innerHTML = `
          <h3><a href="${url}" target="_blank" rel="noopener">${title}</a></h3>
          <div class="meta">
            <span class="chip">${company}</span>
            <span class="chip">${loc}</span>
            <span class="chip">Source: ${src}</span>
            ${match !== null ? <span class="chip ok">Match: ${match}%</span> : ``}
            ${posted ? <span class="chip">Posted: ${posted.toLocaleDateString()}</span> : ``}
          </div>`;
        frag.appendChild(a);
      }
      resultsEl.appendChild(frag);
    }

    async function load(page=1){
      state.page = Math.max(1, Number(page) || 1);
      pageEl.textContent = state.page;

      const qs = new URLSearchParams();
      if (state.country) qs.set("country", state.country);
      if (state.q) qs.set("q", state.q);
      if (state.limit) qs.set("limit", String(state.limit));
      if (state.page > 1) qs.set("page", String(state.page));
      history.replaceState(null, "", location.pathname + (qs.toString()??${qs.toString()}:""));

      const url = buildURL(state.page);
      setStatus("Loadingâ€¦");
      setLoading(true);
      skeleton();

      try{
        const resp = await fetch(url, { method:"GET", headers:{ "Accept":"application/json" } });
        const text = await resp.text();
        if (!resp.ok){ throw new Error(HTTP ${resp.status}: ${text.slice(0,180)}); }

        let data = [];
        try{
          const parsed = JSON.parse(text);
          data = Array.isArray(parsed) ? parsed :
                 (parsed && Array.isArray(parsed.items) ? parsed.items : []);
        }catch{ data = []; }

        render(data);
        prevBtn.disabled = state.page<=1;
        nextBtn.disabled = data.length < state.limit;
        setStatus(Loaded ${data.length} job${data.length===1?"":"s"}.);
      }catch(err){
        console.error(err);
        render([]);
        prevBtn.disabled = state.page<=1; nextBtn.disabled = true;
        setStatus("Couldnâ€™t load jobs.");
        toast("Network/API error: " + (err?.message || "please try again."));
      }finally{
        setLoading(false);
      }
    }

    // events
    loadBtn.addEventListener("click", () => {
      state.country = countryEl.value.trim();
      state.q = qEl.value.trim();
      state.limit = Number(limitEl.value) || 20;
      load(1);
    });
    resetBtn.addEventListener("click", () => {
      countryEl.value=""; qEl.value=""; limitEl.value="20";
      state.country=""; state.q=""; state.limit=20; load(1);
    });
    nextBtn.addEventListener("click", () => load(state.page+1));
    prevBtn.addEventListener("click", () => load(state.page-1));
    qEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter") load(1); });

    // initial
    await load(state.page);
  })();
  </script>
</body>
</html>
