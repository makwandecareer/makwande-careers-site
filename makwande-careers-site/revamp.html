<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CV Revamp | Makwande Careers</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- App & Bootstrap CSS -->
  <link rel="stylesheet" href="assets/css/app.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg fixed-top bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="index.html">Makwande Careers</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="navMain" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a href="jobs.html" class="nav-link">Jobs</a></li>
          <li class="nav-item"><a href="cv-revamp.html" class="nav-link active">CV Revamp</a></li>
          <li class="nav-item"><a href="cover-letter.html" class="nav-link">Cover Letter</a></li>
          <li class="nav-item"><a href="dashboard.html" class="nav-link">Dashboard</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="container" style="margin-top: 5.5rem;">
    <header class="mb-4">
      <h2 class="mb-1">AI-Powered CV Revamp</h2>
      <p class="lead mb-0">Paste your CV and job description. We’ll restructure it for ATS compliance and recruiter impact.</p>
    </header>

    <!-- Alerts -->
    <div id="alertBox" class="d-none"></div>

    <!-- CV Revamp Form -->
    <form id="cvRevampForm" class="card shadow-sm border-0 p-4">
      <div class="row g-3">
        <div class="col-md-6">
          <label for="job_title" class="form-label">Target Job Title</label>
          <input type="text" id="job_title" class="form-control" placeholder="e.g., Process Engineer" />
        </div>
        <div class="col-md-6">
          <label for="seniority" class="form-label">Seniority</label>
          <select id="seniority" class="form-select">
            <option value="">Select…</option>
            <option value="Junior">Junior</option>
            <option value="Mid">Mid</option>
            <option value="Senior">Senior</option>
          </select>
        </div>
        <div class="col-md-6">
          <label for="country" class="form-label">Target Country</label>
          <input type="text" id="country" class="form-control" placeholder="e.g., South Africa" />
        </div>
        <div class="col-12">
          <label for="job_description" class="form-label">Job Description</label>
          <textarea id="job_description" class="form-control" rows="5" placeholder="Paste the job description here..."></textarea>
        </div>
        <div class="col-12">
          <label for="cv_text" class="form-label">Your CV (Plain Text)</label>
          <textarea id="cv_text" class="form-control" rows="12" placeholder="Paste your CV text here..." required></textarea>
          <div class="form-text">Tip: Paste plain text. If you have a PDF/DOCX, convert/extract to text first.</div>
        </div>
      </div>
      <div class="d-grid mt-4">
        <button type="submit" class="btn btn-primary btn-lg">Revamp My CV</button>
      </div>
    </form>

    <!-- Results -->
    <section id="revampResults" class="mt-4 d-none">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h4 class="mb-3">Revamped CV Results</h4>
          <p><strong>ATS Score:</strong> <span id="ats_score"></span>%</p>
          <h5>Summary</h5>
          <p id="cv_summary"></p>
          <h5>Improvement Tips</h5>
          <ul id="improvement_tips"></ul>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-dark text-light text-center py-4 mt-5">
    <div class="container">
      <p class="mb-1">&copy; <span id="year"></span> Makwande Careers. All rights reserved.</p>
      <p class="small mb-0">Empowering Africa’s professionals with smarter job applications, bursaries, and career growth.</p>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- App JS -->
  <script>
    // ----------------- CONFIG -----------------
    const API_BASE = "https://autoapplyapp.onrender.com";

    // ----------------- HELPERS ----------------
    function showAlert(type, msg) {
      const box = document.getElementById("alertBox");
      box.className = `alert alert-${type}`;
      box.textContent = msg;
      box.classList.remove("d-none");
    }
    function hideAlert() {
      const box = document.getElementById("alertBox");
      box.className = "d-none";
      box.textContent = "";
    }
    async function postJSON(path, payload) {
      const res = await fetch(`${API_BASE}${path}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });
      const data = await res.json().catch(() => ({}));
      if (!res.ok) throw new Error(data?.detail || `HTTP ${res.status}`);
      return data;
    }
    function setYear() {
      document.getElementById("year").textContent = new Date().getFullYear();
    }

    // ----------------- FORM HOOKUP ------------
    document.addEventListener("DOMContentLoaded", () => {
      setYear();

      const form = document.getElementById("cvRevampForm");
      const results = document.getElementById("revampResults");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        hideAlert();

        const btn = form.querySelector('button[type="submit"]');
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.textContent = "Revamping…";

        const payload = {
          job_title: document.getElementById("job_title").value.trim(),
          job_description: document.getElementById("job_description").value.trim(),
          cv_text: document.getElementById("cv_text").value.trim(),
          target_country: document.getElementById("country").value.trim(),
          seniority: document.getElementById("seniority").value
        };

        if (!payload.cv_text) {
          showAlert("warning", "Please paste your CV text first.");
          btn.disabled = false;
          btn.textContent = originalText;
          return;
        }

        try {
          const data = await postJSON("/api/revamp_cv", payload);
          document.getElementById("ats_score").textContent = data.ats_score ?? "";
          document.getElementById("cv_summary").textContent = data.summary ?? "";
          const tipsUl = document.getElementById("improvement_tips");
          tipsUl.innerHTML = "";
          (data.improvement_tips || []).forEach((tip) => {
            const li = document.createElement("li");
            li.textContent = tip;
            tipsUl.appendChild(li);
          });
          results.classList.remove("d-none");
        } catch (err) {
          showAlert("danger", `CV Revamp failed: ${err.message}`);
        } finally {
          btn.disabled = false;
          btn.textContent = originalText;
        }
      });
    });
  </script>
</body>
</html>
